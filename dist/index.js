var b=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var M=b(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});function Ue(e){return e==null?"":typeof e=="string"||e instanceof String?e:JSON.stringify(e)}k.toCommandValue=Ue});var Z=b(O=>{"use strict";var je=O&&O.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(O,"__esModule",{value:!0});var He=je(require("os")),z=M();function Q(e,t,n){let s=new K(e,t,n);process.stdout.write(s.toString()+He.EOL)}O.issueCommand=Q;function Xe(e,t=""){Q(e,{},t)}O.issue=Xe;var W="::",K=class{constructor(t,n,s){t||(t="missing.command"),this.command=t,this.properties=n,this.message=s}toString(){let t=W+this.command;if(this.properties&&Object.keys(this.properties).length>0){t+=" ";let n=!0;for(let s in this.properties)if(this.properties.hasOwnProperty(s)){let i=this.properties[s];i&&(n?n=!1:t+=",",t+=`${s}=${ze(i)}`)}}return t+=`${W}${Ye(this.message)}`,t}};function Ye(e){return z.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function ze(e){return z.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}});var te=b(w=>{"use strict";var D=w&&w.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(w,"__esModule",{value:!0});var ee=D(require("fs")),Ke=D(require("os")),Qe=M();function We(e,t){let n=process.env[`GITHUB_${e}`];if(!n)throw new Error(`Unable to find environment variable for file command ${e}`);if(!ee.existsSync(n))throw new Error(`Missing file at path: ${n}`);ee.appendFileSync(n,`${Qe.toCommandValue(t)}${Ke.EOL}`,{encoding:"utf8"})}w.issueCommand=We});var ae=b(f=>{"use strict";var Ze=f&&f.__awaiter||function(e,t,n,s){function i(r){return r instanceof n?r:new n(function(u){u(r)})}return new(n||(n=Promise))(function(r,u){function o(c){try{l(s.next(c))}catch(d){u(d)}}function a(c){try{l(s.throw(c))}catch(d){u(d)}}function l(c){c.done?r(c.value):i(c.value).then(o,a)}l((s=s.apply(e,t||[])).next())})},re=f&&f.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(f,"__esModule",{value:!0});var N=Z(),ne=te(),De=M(),G=re(require("os")),et=re(require("path")),se;(function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure"})(se=f.ExitCode||(f.ExitCode={}));function tt(e,t){let n=De.toCommandValue(t);if(process.env[e]=n,process.env.GITHUB_ENV||""){let i="_GitHubActionsFileCommandDelimeter_",r=`${e}<<${i}${G.EOL}${n}${G.EOL}${i}`;ne.issueCommand("ENV",r)}else N.issueCommand("set-env",{name:e},n)}f.exportVariable=tt;function rt(e){N.issueCommand("add-mask",{},e)}f.setSecret=rt;function nt(e){process.env.GITHUB_PATH||""?ne.issueCommand("PATH",e):N.issueCommand("add-path",{},e),process.env.PATH=`${e}${et.delimiter}${process.env.PATH}`}f.addPath=nt;function st(e,t){let n=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!n)throw new Error(`Input required and not supplied: ${e}`);return n.trim()}f.getInput=st;function it(e,t){N.issueCommand("set-output",{name:e},t)}f.setOutput=it;function ot(e){N.issue("echo",e?"on":"off")}f.setCommandEcho=ot;function ut(e){process.exitCode=se.Failure,ie(e)}f.setFailed=ut;function at(){return process.env.RUNNER_DEBUG==="1"}f.isDebug=at;function ct(e){N.issueCommand("debug",{},e)}f.debug=ct;function ie(e){N.issue("error",e instanceof Error?e.toString():e)}f.error=ie;function lt(e){N.issue("warning",e instanceof Error?e.toString():e)}f.warning=lt;function ft(e){process.stdout.write(e+G.EOL)}f.info=ft;function oe(e){N.issue("group",e)}f.startGroup=oe;function ue(){N.issue("endgroup")}f.endGroup=ue;function dt(e,t){return Ze(this,void 0,void 0,function*(){oe(e);let n;try{n=yield t()}finally{ue()}return n})}f.group=dt;function ht(e,t){N.issueCommand("save-state",{name:e},t)}f.saveState=ht;function gt(e){return process.env[`STATE_${e}`]||""}f.getState=gt});var T=b(A=>{"use strict";var ce=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",pt=ce+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",le="["+ce+"]["+pt+"]*",bt=new RegExp("^"+le+"$"),mt=function(e,t){let n=[],s=t.exec(e);for(;s;){let i=[],r=s.length;for(let u=0;u<r;u++)i.push(s[u]);n.push(i),s=t.exec(e)}return n},Nt=function(e){let t=bt.exec(e);return!(t===null||typeof t=="undefined")};A.isExist=function(e){return typeof e!="undefined"};A.isEmptyObject=function(e){return Object.keys(e).length===0};A.merge=function(e,t,n){if(t){let s=Object.keys(t),i=s.length;for(let r=0;r<i;r++)n==="strict"?e[s[r]]=[t[s[r]]]:e[s[r]]=t[s[r]]}};A.getValue=function(e){return A.isExist(e)?e:""};A.buildOptions=function(e,t,n){var s={};if(!e)return t;for(let i=0;i<n.length;i++)e[n[i]]!==void 0?s[n[i]]=e[n[i]]:s[n[i]]=t[n[i]];return s};A.isTagNameInArrayMode=function(e,t,n){return t===!1?!1:t instanceof RegExp?t.test(e):typeof t=="function"?!!t(e,n):t==="strict"};A.isName=Nt;A.getAllMatches=mt;A.nameRegexp=le});var de=b(fe=>{"use strict";var _=T(),J=function(e,t,n){let s={};if((!e.child||_.isEmptyObject(e.child))&&(!e.attrsMap||_.isEmptyObject(e.attrsMap)))return _.isExist(e.val)?e.val:"";if(_.isExist(e.val)&&!(typeof e.val=="string"&&(e.val===""||e.val===t.cdataPositionChar))){let r=_.isTagNameInArrayMode(e.tagname,t.arrayMode,n);s[t.textNodeName]=r?[e.val]:e.val}_.merge(s,e.attrsMap,t.arrayMode);let i=Object.keys(e.child);for(let r=0;r<i.length;r++){let u=i[r];if(e.child[u]&&e.child[u].length>1){s[u]=[];for(let o in e.child[u])e.child[u].hasOwnProperty(o)&&s[u].push(J(e.child[u][o],t,u))}else{let o=J(e.child[u][0],t,u),a=t.arrayMode===!0&&typeof o=="object"||_.isTagNameInArrayMode(u,t.arrayMode,n);s[u]=a?[o]:o}}return s};fe.convertToJson=J});var ge=b((Er,he)=>{"use strict";he.exports=function(e,t,n){this.tagname=e,this.parent=t,this.child={},this.attrsMap={},this.val=n,this.addChild=function(s){Array.isArray(this.child[s.tagname])?this.child[s.tagname].push(s):this.child[s.tagname]=[s]}}});var I=b(F=>{"use strict";var E=T(),At=T().buildOptions,q=ge(),Or="<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,E.nameRegexp);!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);var pe={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",tagValueProcessor:function(e,t){return e},attrValueProcessor:function(e,t){return e},stopNodes:[]};F.defaultOptions=pe;var be=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","stopNodes"];F.props=be;function $(e,t,n){return t&&(n.trimValues&&(t=t.trim()),t=n.tagValueProcessor(t,e),t=me(t,n.parseNodeValue,n.parseTrueNumberOnly)),t}function Ct(e,t){if(t.ignoreNameSpace){let n=e.split(":"),s=e.charAt(0)==="/"?"/":"";if(n[0]==="xmlns")return"";n.length===2&&(e=s+n[1])}return e}function me(e,t,n){if(t&&typeof e=="string"){let s;return e.trim()===""||isNaN(e)?s=e==="true"?!0:e==="false"?!1:e:(e.indexOf("0x")!==-1?s=Number.parseInt(e,16):e.indexOf(".")!==-1?(s=Number.parseFloat(e),e=e.replace(/\.?0+$/,"")):s=Number.parseInt(e,10),n&&(s=String(s)===e?s:e)),s}else return E.isExist(e)?e:""}var yt=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])(.*?)\\3)?`,"g");function Ne(e,t){if(!t.ignoreAttributes&&typeof e=="string"){e=e.replace(/\r?\n/g," ");let n=E.getAllMatches(e,yt),s=n.length,i={};for(let r=0;r<s;r++){let u=Ct(n[r][1],t);u.length&&(n[r][4]!==void 0?(t.trimValues&&(n[r][4]=n[r][4].trim()),n[r][4]=t.attrValueProcessor(n[r][4],u),i[t.attributeNamePrefix+u]=me(n[r][4],t.parseAttributeValue,t.parseTrueNumberOnly)):t.allowBooleanAttributes&&(i[t.attributeNamePrefix+u]=!0))}if(!Object.keys(i).length)return;if(t.attrNodeName){let r={};return r[t.attrNodeName]=i,r}return i}}var vt=function(e,t){e=e.replace(/\r\n?/g,`
`),t=At(t,pe,be);let n=new q("!xml"),s=n,i="";for(let r=0;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="/"){let o=P(e,">",r,"Closing Tag is not closed."),a=e.substring(r+2,o).trim();if(t.ignoreNameSpace){let l=a.indexOf(":");l!==-1&&(a=a.substr(l+1))}s&&(s.val?s.val=E.getValue(s.val)+""+$(a,i,t):s.val=$(a,i,t)),t.stopNodes.length&&t.stopNodes.includes(s.tagname)&&(s.child=[],s.attrsMap==null&&(s.attrsMap={}),s.val=e.substr(s.startIndex+1,r-s.startIndex-1)),s=s.parent,i="",r=o}else if(e[r+1]==="?")r=P(e,"?>",r,"Pi Tag is not closed.");else if(e.substr(r+1,3)==="!--")r=P(e,"-->",r,"Comment is not closed.");else if(e.substr(r+1,2)==="!D"){let o=P(e,">",r,"DOCTYPE is not closed.");e.substring(r,o).indexOf("[")>=0?r=e.indexOf("]>",r)+1:r=o}else if(e.substr(r+1,2)==="!["){let o=P(e,"]]>",r,"CDATA is not closed.")-2,a=e.substring(r+9,o);if(i&&(s.val=E.getValue(s.val)+""+$(s.tagname,i,t),i=""),t.cdataTagName){let l=new q(t.cdataTagName,s,a);s.addChild(l),s.val=E.getValue(s.val)+t.cdataPositionChar,a&&(l.val=a)}else s.val=(s.val||"")+(a||"");r=o+2}else{let o=Tt(e,r+1),a=o.data,l=o.index,c=a.indexOf(" "),d=a,Y=!0;if(c!==-1&&(d=a.substr(0,c).replace(/\s\s*$/,""),a=a.substr(c+1)),t.ignoreNameSpace){let m=d.indexOf(":");m!==-1&&(d=d.substr(m+1),Y=d!==o.data.substr(m+1))}if(s&&i&&s.tagname!=="!xml"&&(s.val=E.getValue(s.val)+""+$(s.tagname,i,t)),a.length>0&&a.lastIndexOf("/")===a.length-1){d[d.length-1]==="/"?(d=d.substr(0,d.length-1),a=d):a=a.substr(0,a.length-1);let m=new q(d,s,"");d!==a&&(m.attrsMap=Ne(a,t)),s.addChild(m)}else{let m=new q(d,s);t.stopNodes.length&&t.stopNodes.includes(m.tagname)&&(m.startIndex=l),d!==a&&Y&&(m.attrsMap=Ne(a,t)),s.addChild(m),s=m}i="",r=l}else i+=e[r];return n};function Tt(e,t){let n,s="";for(let i=t;i<e.length;i++){let r=e[i];if(n)r===n&&(n="");else if(r==='"'||r==="'")n=r;else{if(r===">")return{data:s,index:i};r==="	"&&(r=" ")}s+=r}}function P(e,t,n,s){let i=e.indexOf(t,n);if(i===-1)throw new Error(s);return i+t.length-1}F.getTraversalObj=vt});var ve=b(Ae=>{"use strict";var R=T(),_t={allowBooleanAttributes:!1},Et=["allowBooleanAttributes"];Ae.validate=function(e,t){t=R.buildOptions(t,_t,Et);let n=[],s=!1,i=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let r=0;r<e.length;r++)if(e[r]==="<"&&e[r+1]==="?"){if(r+=2,r=Ce(e,r),r.err)return r}else if(e[r]==="<")if(r++,e[r]==="!"){r=ye(e,r);continue}else{let u=!1;e[r]==="/"&&(u=!0,r++);let o="";for(;r<e.length&&e[r]!==">"&&e[r]!==" "&&e[r]!=="	"&&e[r]!==`
`&&e[r]!=="\r";r++)o+=e[r];if(o=o.trim(),o[o.length-1]==="/"&&(o=o.substring(0,o.length-1),r--),!Pt(o)){let c;return o.trim().length===0?c="There is an unnecessary space between tag name and backward slash '</ ..'.":c="Tag '"+o+"' is an invalid name.",p("InvalidTag",c,C(e,r))}let a=Ot(e,r);if(a===!1)return p("InvalidAttr","Attributes for '"+o+"' have open quote.",C(e,r));let l=a.value;if(r=a.index,l[l.length-1]==="/"){l=l.substring(0,l.length-1);let c=Te(l,t);if(c===!0)s=!0;else return p(c.err.code,c.err.msg,C(e,r-l.length+c.err.line))}else if(u)if(a.tagClosed){if(l.trim().length>0)return p("InvalidTag","Closing tag '"+o+"' can't have attributes or invalid starting.",C(e,r));{let c=n.pop();if(o!==c)return p("InvalidTag","Closing tag '"+c+"' is expected inplace of '"+o+"'.",C(e,r));n.length==0&&(i=!0)}}else return p("InvalidTag","Closing tag '"+o+"' doesn't have proper closing.",C(e,r));else{let c=Te(l,t);if(c!==!0)return p(c.err.code,c.err.msg,C(e,r-l.length+c.err.line));if(i===!0)return p("InvalidXml","Multiple possible root nodes found.",C(e,r));n.push(o),s=!0}for(r++;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="!"){r++,r=ye(e,r);continue}else if(e[r+1]==="?"){if(r=Ce(e,++r),r.err)return r}else break;else if(e[r]==="&"){let c=wt(e,r);if(c==-1)return p("InvalidChar","char '&' is not expected.",C(e,r));r=c}e[r]==="<"&&r--}else{if(e[r]===" "||e[r]==="	"||e[r]===`
`||e[r]==="\r")continue;return p("InvalidChar","char '"+e[r]+"' is not expected.",C(e,r))}if(s){if(n.length>0)return p("InvalidXml","Invalid '"+JSON.stringify(n,null,4).replace(/\r?\n/g,"")+"' found.",1)}else return p("InvalidXml","Start tag expected.",1);return!0};function Ce(e,t){for(var n=t;t<e.length;t++)if(e[t]=="?"||e[t]==" "){var s=e.substr(n,t-n);if(t>5&&s==="xml")return p("InvalidXml","XML declaration allowed only at the start of the document.",C(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function ye(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let n=1;for(t+=8;t<e.length;t++)if(e[t]==="<")n++;else if(e[t]===">"&&(n--,n===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}var It='"',St="'";function Ot(e,t){let n="",s="",i=!1;for(;t<e.length;t++){if(e[t]===It||e[t]===St)if(s==="")s=e[t];else{if(s!==e[t])continue;s=""}else if(e[t]===">"&&s===""){i=!0;break}n+=e[t]}return s!==""?!1:{value:n,index:t,tagClosed:i}}var Vt=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Te(e,t){let n=R.getAllMatches(e,Vt),s={};for(let i=0;i<n.length;i++){if(n[i][1].length===0)return p("InvalidAttr","Attribute '"+n[i][2]+"' has no space in starting.",L(e,n[i][0]));if(n[i][3]===void 0&&!t.allowBooleanAttributes)return p("InvalidAttr","boolean attribute '"+n[i][2]+"' is not allowed.",L(e,n[i][0]));let r=n[i][2];if(!Mt(r))return p("InvalidAttr","Attribute '"+r+"' is an invalid name.",L(e,n[i][0]));if(!s.hasOwnProperty(r))s[r]=1;else return p("InvalidAttr","Attribute '"+r+"' is repeated.",L(e,n[i][0]))}return!0}function Ft(e,t){let n=/\d/;for(e[t]==="x"&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(n))break}return-1}function wt(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,Ft(e,t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(e[t]===";")break;return-1}return t}function p(e,t,n){return{err:{code:e,msg:t,line:n}}}function Mt(e){return R.isName(e)}function Pt(e){return R.isName(e)}function C(e,t){var n=e.substring(0,t).split(/\r?\n/);return n.length}function L(e,t){return e.indexOf(t)+t.length}});var we=b(_e=>{"use strict";var v=function(e){return String.fromCharCode(e)},h={nilChar:v(176),missingChar:v(201),nilPremitive:v(175),missingPremitive:v(200),emptyChar:v(178),emptyValue:v(177),boundryChar:v(179),objStart:v(198),arrStart:v(204),arrayEnd:v(185)},qt=[h.nilChar,h.nilPremitive,h.missingChar,h.missingPremitive,h.boundryChar,h.emptyChar,h.emptyValue,h.arrayEnd,h.objStart,h.arrStart],S=function(e,t,n){if(typeof t=="string")return e&&e[0]&&e[0].val!==void 0?U(e[0].val,t):U(e,t);{let s=$t(e);if(s===!0){let i="";if(Array.isArray(t)){i+=h.arrStart;let r=t[0],u=e.length;if(typeof r=="string")for(let o=0;o<u;o++){let a=U(e[o].val,r);i=j(i,a)}else for(let o=0;o<u;o++){let a=S(e[o],r,n);i=j(i,a)}i+=h.arrayEnd}else{i+=h.objStart;let r=Object.keys(t);Array.isArray(e)&&(e=e[0]);for(let u in r){let o=r[u],a;!n.ignoreAttributes&&e.attrsMap&&e.attrsMap[o]?a=S(e.attrsMap[o],t[o],n):o===n.textNodeName?a=S(e.val,t[o],n):a=S(e.child[o],t[o],n),i=j(i,a)}}return i}else return s}},U=function(e){switch(e){case void 0:return h.missingPremitive;case null:return h.nilPremitive;case"":return h.emptyValue;default:return e}},j=function(e,t){return!Ee(t[0])&&!Ee(e[e.length-1])&&(e+=h.boundryChar),e+t},Ee=function(e){return qt.indexOf(e)!==-1};function $t(e){return e===void 0?h.missingChar:e===null?h.nilChar:e.child&&Object.keys(e.child).length===0&&(!e.attrsMap||Object.keys(e.attrsMap).length===0)?h.emptyChar:!0}var Oe=I(),Rt=T().buildOptions,Lt=function(e,t,n){return n=Rt(n,Oe.defaultOptions,Oe.props),S(e,t,n)};_e.convert2nimn=Lt});var Se=b(Pe=>{"use strict";var x=T(),xt=T().buildOptions,Ie=I(),Bt=function(e,t){return t=xt(t,Ie.defaultOptions,Ie.props),t.indentBy=t.indentBy||"",H(e,t,0)},H=function(e,t,n){let s="{",i=Object.keys(e.child);for(let o=0;o<i.length;o++){var r=i[o];if(e.child[r]&&e.child[r].length>1){s+='"'+r+'" : [ ';for(var u in e.child[r])s+=H(e.child[r][u],t)+" , ";s=s.substr(0,s.length-1)+" ] "}else s+='"'+r+'" : '+H(e.child[r][0],t)+" ,"}return x.merge(s,e.attrsMap),x.isEmptyObject(s)?x.isExist(e.val)?e.val:"":(x.isExist(e.val)&&(typeof e.val=="string"&&(e.val===""||e.val===t.cdataPositionChar)||(s+='"'+t.textNodeName+'" : '+kt(e.val))),s[s.length-1]===","&&(s=s.substr(0,s.length-2)),s+"}")};function kt(e){return e===!0||e===!1||!isNaN(e)?e:'"'+e+'"'}Pe.convertToJsonString=Bt});var qe=b((Vr,Ve)=>{"use strict";var Gt=T().buildOptions,Jt={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(e){return e},attrValueProcessor:function(e){return e}},Ut=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor"];function X(e){this.options=Gt(e,Jt,Ut),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Kt),this.options.cdataTagName?this.isCDATA=Qt:this.isCDATA=function(){return!1},this.replaceCDATAstr=jt,this.replaceCDATAarr=Ht,this.options.format?(this.indentate=zt,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=Yt,this.buildObjNode=Xt):(this.buildTextNode=Fe,this.buildObjNode=Me),this.buildTextValNode=Fe,this.buildObjectNode=Me}X.prototype.parse=function(e){return this.j2x(e,0).val};X.prototype.j2x=function(e,t){let n="",s="",i=Object.keys(e),r=i.length;for(let u=0;u<r;u++){let o=i[u];if(typeof e[o]!="undefined")if(e[o]===null)s+=this.indentate(t)+"<"+o+"/"+this.tagEndChar;else if(e[o]instanceof Date)s+=this.buildTextNode(e[o],o,"",t);else if(typeof e[o]!="object"){let a=this.isAttribute(o);a?n+=" "+a+'="'+this.options.attrValueProcessor(""+e[o])+'"':this.isCDATA(o)?e[this.options.textNodeName]?s+=this.replaceCDATAstr(e[this.options.textNodeName],e[o]):s+=this.replaceCDATAstr("",e[o]):o===this.options.textNodeName?e[this.options.cdataTagName]||(s+=this.options.tagValueProcessor(""+e[o])):s+=this.buildTextNode(e[o],o,"",t)}else if(Array.isArray(e[o]))if(this.isCDATA(o))s+=this.indentate(t),e[this.options.textNodeName]?s+=this.replaceCDATAarr(e[this.options.textNodeName],e[o]):s+=this.replaceCDATAarr("",e[o]);else{let a=e[o].length;for(let l=0;l<a;l++){let c=e[o][l];if(typeof c!="undefined")if(c===null)s+=this.indentate(t)+"<"+o+"/"+this.tagEndChar;else if(typeof c=="object"){let d=this.j2x(c,t+1);s+=this.buildObjNode(d.val,o,d.attrStr,t)}else s+=this.buildTextNode(c,o,"",t)}}else if(this.options.attrNodeName&&o===this.options.attrNodeName){let a=Object.keys(e[o]),l=a.length;for(let c=0;c<l;c++)n+=" "+a[c]+'="'+this.options.attrValueProcessor(""+e[o][a[c]])+'"'}else{let a=this.j2x(e[o],t+1);s+=this.buildObjNode(a.val,o,a.attrStr,t)}}return{attrStr:n,val:s}};function jt(e,t){return e=this.options.tagValueProcessor(""+e),this.options.cdataPositionChar===""||e===""?e+"<![CDATA["+t+"]]"+this.tagEndChar:e.replace(this.options.cdataPositionChar,"<![CDATA["+t+"]]"+this.tagEndChar)}function Ht(e,t){if(e=this.options.tagValueProcessor(""+e),this.options.cdataPositionChar===""||e==="")return e+"<![CDATA["+t.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let n in t)e=e.replace(this.options.cdataPositionChar,"<![CDATA["+t[n]+"]]>");return e+this.newLine}function Me(e,t,n,s){return n&&!e.includes("<")?this.indentate(s)+"<"+t+n+">"+e+"</"+t+this.tagEndChar:this.indentate(s)+"<"+t+n+this.tagEndChar+e+this.indentate(s)+"</"+t+this.tagEndChar}function Xt(e,t,n,s){return e!==""?this.buildObjectNode(e,t,n,s):this.indentate(s)+"<"+t+n+"/"+this.tagEndChar}function Fe(e,t,n,s){return this.indentate(s)+"<"+t+n+">"+this.options.tagValueProcessor(e)+"</"+t+this.tagEndChar}function Yt(e,t,n,s){return e!==""?this.buildTextValNode(e,t,n,s):this.indentate(s)+"<"+t+n+"/"+this.tagEndChar}function zt(e){return this.options.indentBy.repeat(e)}function Kt(e){return e.startsWith(this.options.attributeNamePrefix)?e.substr(this.attrPrefixLen):!1}function Qt(e){return e===this.options.cdataTagName}Ve.exports=X});var Be=b(y=>{"use strict";var $e=de(),Re=I(),Le=I(),Wt=T().buildOptions,xe=ve();y.parse=function(e,t,n){if(n){n===!0&&(n={});let i=xe.validate(e,n);if(i!==!0)throw Error(i.err.msg)}t=Wt(t,Le.defaultOptions,Le.props);let s=Re.getTraversalObj(e,t);return $e.convertToJson(s,t)};y.convertTonimn=we().convert2nimn;y.getTraversalObj=Re.getTraversalObj;y.convertToJson=$e.convertToJson;y.convertToJsonString=Se().convertToJsonString;y.validate=xe.validate;y.j2xParser=qe();y.parseToNimn=function(e,t,n){return y.convertTonimn(y.getTraversalObj(e,n),t,n)}});var Ge=b((Fr,ke)=>{var{spawn:Zt}=require("child_process"),Dt=(e,t=[],n={})=>new Promise((s,i)=>{let r="",u={...n};u.stdio||Object.assign(u,{stdio:["inherit","inherit","inherit"]});let o=Zt(e,t,u);o.stdout&&o.stdout.on("data",function(a){r+=a.toString()}),o.on("close",a=>a!==0?i({code:a,outputData:r}):s({code:a,outputData:r})),o.on("error",()=>i({code:1,outputData:r}))});ke.exports=Dt});var er=require("https"),Je=require("fs"),g=ae(),tr=Be(),V=Ge(),rr=g.getInput("goodreads_user_id"),nr=g.getInput("shelf"),sr=Number.parseInt(g.getInput("max_books_count")),B=g.getInput("readme_file_path"),ir=g.getInput("output_only").toLowerCase()==="true",or=g.getInput("template")||"- [$title]($url) by $author (\u2B50\uFE0F$average_rating)",ur="Synced and updated with user's goodreads book lists",ar="goodreads-books-bot",cr="goodreads-books-bot@example.com",lr=g.getInput("sort_by_fields"),fr=["pubDate","user_read_at","user_date_added","user_date_created"];dr(rr,nr).then(async e=>{try{if(!e.rss.channel.item)return;let t=Array.isArray(e.rss.channel.item)?e.rss.channel.item:[e.rss.channel.item],s=gr(t,lr).slice(0,sr),i=Je.readFileSync(B,"utf8"),r=hr(i,s);i!==r&&(g.info(`Writing to ${B}`),g.startGroup("New books found for update"),s.forEach(u=>g.info(JSON.stringify(u))),g.endGroup(),Je.writeFileSync(B,r),ir?(g.setOutput("books",s),g.info("OUTPUT_ONLY: set `results` variable. Readme not committed.")):await pr())}catch(t){g.error(t),process.exit(1)}}).then(()=>{process.exit(0)}).catch(e=>{g.error(e),process.exit(1)});function dr(e,t){return new Promise((n,s)=>{er.request({host:"www.goodreads.com",path:`/review/list_rss/${e}?shelf=${t}`},i=>{let r="";i.on("data",u=>r+=u),i.on("end",()=>n(tr.parse(r))),i.on("error",u=>s(u))}).end()})}function hr(e,t){let n=g.getInput("comment_tag_name")||"GOODREADS-LIST",s=`<!-- ${n}:START -->`,i=`<!-- ${n}:END -->`;if(![s,i].every(u=>e.match(new RegExp(u,"gm"))))g.error(`Cannot find the required comment tags (${s} and ${i}) to inject book titles.`),process.exit(1);else{let u=e.indexOf(s),o=e.indexOf(i),a=br(t);return[e.substring(0,u+s.length),`
`,a,`
`,e.substring(o)].join("")}}function br(e){return e.map(t=>mr(or,{title:t.title,url:t.link,author:t.author_name,published_year:t.book_published,average_rating:t.average_rating,my_rating:t.user_rating,my_rating_stars:t.user_rating?"\u2B50".repeat(Number.parseInt(t.user_rating||"0")):"unrated"})).join(`
`)}function gr(e,t){if(!t||t.length===0)return e;let s=t.split(",").map(i=>({term:i.replace(/<|>/g,r=>""),direction:i.indexOf("<")>-1?"asc":"desc"}));return e.sort((i,r)=>s.map(u=>{let o=!isNaN(i[u.term])&&!isNaN(r[u.term]),a=u.direction==="asc"?-1:1,l,c;return fr.includes(u.term)?(l=i[u.term]?new Date(i[u.term]).getTime()+"":"",c=r[u.term]?new Date(r[u.term]).getTime()+"":""):(l=String(i[u.term]),c=String(r[u.term])),c.localeCompare(l,"en",{numeric:o})*a}).reduce((u,o)=>u===0?o:u,0))}function mr(e,t){let n=/\$([a-zA-Z_]*)/g;return e.replace(n,(s,i)=>t[i]||"")}async function pr(){await V("git",["config","--global","user.email",cr]),await V("git",["config","--global","user.name",ar]),await V("git",["add",B]),await V("git",["commit","-m",ur]),await V("git",["push"]),g.info("Readme updated successfully in the upstream repository"),process.exit(0)}
